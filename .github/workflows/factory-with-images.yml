name: üè≠ Content Factory (Articles + Images)

on:
  workflow_dispatch:
    inputs:
      count:
        description: 'Number of articles'
        required: false
        default: '5'
        type: choice
        options:
          - '1'
          - '5'
          - '10'
          - '25'
          - '50'
          - '100'
      
      images:
        description: 'Generate images?'
        required: false
        default: 'true'
        type: choice
        options:
          - 'true'
          - 'false'
      
      quality:
        description: 'Quality level'
        required: false
        default: 'premium'
        type: choice
        options:
          - 'standard'
          - 'premium'

permissions:
  contents: write

jobs:
  factory:
    runs-on: ubuntu-latest
    timeout-minutes: 360
    
    steps:
      - uses: actions/checkout@v4
      
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      
      - run: npm install
      
      - name: üè≠ Content Factory
        run: |
          COUNT=${{ inputs.count }}
          IMAGES=${{ inputs.images }}
          QUALITY=${{ inputs.quality }}
          
          echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
          echo "üè≠ CONTENT FACTORY - v4.0"
          echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
          echo "üìä Articles:  $COUNT"
          echo "üñºÔ∏è  Images:    $IMAGES"
          echo "‚ú® Quality:   $QUALITY"
          echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
          
          # Build command
          CMD="npm run factory -- --count=$COUNT --quality=$QUALITY"
          
          if [ "$IMAGES" = "true" ]; then
            CMD="$CMD --images"
            echo "‚úÖ Images ENABLED"
          else
            echo "‚è≠Ô∏è  Images DISABLED (faster)"
          fi
          
          echo ""
          echo "üöÄ Running: $CMD"
          echo ""
          
          $CMD
          
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          API_KEY: ${{ secrets.GEMINI_API_KEY }}
      
      - name: üìä Check results
        run: |
          echo ""
          echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
          echo "üìä RESULTS"
          echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
          
          if [ -d "output" ]; then
            echo "‚úÖ Output directory found"
            
            ARTICLES=$(find output -name "*.txt" -type f 2>/dev/null | wc -l)
            IMAGES=$(find output -name "*.png" -type f 2>/dev/null | wc -l)
            JSON=$(find output -name "*.json" -type f 2>/dev/null | wc -l)
            
            echo "üìù Articles: $ARTICLES"
            echo "üñºÔ∏è  Images:  $IMAGES"
            echo "üìã Metadata: $JSON"
            echo ""
            echo "üìÅ Files:"
            ls -lh output/ 2>/dev/null | head -20
          else
            echo "‚ùå Output directory not found"
          fi
      
      - name: üì§ Upload artifacts
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: factory-output-${{ github.run_id }}
          path: output/
          retention-days: 30
      
      - name: üíæ Commit and push
        run: |
          git config --local user.email "zenmaster-bot@github.com"
          git config --local user.name "ZenMaster Bot"
          
          # Add generated content
          git add output/ || true
          
          COUNT=${{ inputs.count }}
          IMAGES=${{ inputs.images }}
          
          if [ "$IMAGES" = "true" ]; then
            SUFFIX="with images"
          else
            SUFFIX="without images"
          fi
          
          git commit -m "üè≠ Factory: $COUNT articles $SUFFIX" || echo "No changes"
          git push origin HEAD:main || echo "Push failed (OK if no changes)"
        
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
