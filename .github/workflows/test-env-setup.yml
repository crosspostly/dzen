name: Test Environment Setup

on:
  workflow_dispatch:
  push:
    branches: [main, feat/**, feature/**]
    paths:
      - '.github/workflows/**'
      - '.env.example'
      - 'services/finalArticleCleanupGate.ts'
      - 'services/articlePublishGate.ts'

jobs:
  test-env:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Test environment variables
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          API_KEY: ${{ secrets.GEMINI_API_KEY }}
          # v6.0: Article Cleanup System
          FINAL_CLEANUP_ENABLED: true
          CLEANUP_THRESHOLD: medium
          CLEANUP_MODEL: gemini-2.0-flash
          CLEANUP_TEMPERATURE: 0.3
          CLEANUP_MAX_RETRIES: 2
        run: |
          echo "Testing environment setup..."
          npx tsx test-github-actions-env.ts
      
      - name: Summary
        if: success()
        run: |
          echo "✅ Environment setup is correct!"
          echo "✅ All required secrets are configured"
          echo "✅ v6.0 Cleanup System variables are set"
          echo ""
          echo "System ready for article generation!"
