<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convert TXT to MD</title>
    <style>
        :root {
            --color-white: rgba(255, 255, 255, 1);
            --color-black: rgba(0, 0, 0, 1);
            --color-cream-50: rgba(252, 252, 249, 1);
            --color-cream-100: rgba(255, 255, 253, 1);
            --color-gray-200: rgba(245, 245, 245, 1);
            --color-gray-300: rgba(167, 169, 169, 1);
            --color-gray-400: rgba(119, 124, 124, 1);
            --color-slate-500: rgba(98, 108, 113, 1);
            --color-brown-600: rgba(94, 82, 64, 1);
            --color-charcoal-700: rgba(31, 33, 33, 1);
            --color-charcoal-800: rgba(38, 40, 40, 1);
            --color-slate-900: rgba(19, 52, 59, 1);
            --color-teal-300: rgba(50, 184, 198, 1);
            --color-teal-400: rgba(45, 166, 178, 1);
            --color-teal-500: rgba(33, 128, 141, 1);
            --color-teal-600: rgba(29, 116, 128, 1);
            --color-teal-700: rgba(26, 104, 115, 1);
            --color-red-400: rgba(255, 84, 89, 1);
            --color-red-500: rgba(192, 21, 47, 1);

            --color-background: var(--color-cream-50);
            --color-surface: var(--color-cream-100);
            --color-text: var(--color-slate-900);
            --color-text-secondary: var(--color-slate-500);
            --color-primary: var(--color-teal-500);
            --color-primary-hover: var(--color-teal-600);
            --color-primary-active: var(--color-teal-700);
            --color-border: rgba(94, 82, 64, 0.2);
            --color-btn-primary-text: var(--color-cream-50);
            --color-success: var(--color-teal-500);
            --color-error: var(--color-red-500);

            --space-4: 4px;
            --space-8: 8px;
            --space-12: 12px;
            --space-16: 16px;
            --space-20: 20px;
            --space-24: 24px;
            --space-32: 32px;

            --radius-sm: 6px;
            --radius-base: 8px;
            --radius-md: 10px;
            --font-size-base: 14px;
            --font-size-lg: 16px;
            --font-size-xl: 18px;
            --font-size-2xl: 20px;
        }

        * {
            box-sizing: border-box;
        }

        html, body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: var(--color-background);
            color: var(--color-text);
        }

        body {
            padding: var(--space-20);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            font-size: var(--font-size-2xl);
            margin: 0 0 var(--space-8) 0;
            font-weight: 600;
        }

        .subtitle {
            color: var(--color-text-secondary);
            margin-bottom: var(--space-24);
            font-size: var(--font-size-base);
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-24);
            margin-bottom: var(--space-24);
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background-color: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            padding: var(--space-20);
        }

        .card h2 {
            margin: 0 0 var(--space-16) 0;
            font-size: var(--font-size-xl);
            font-weight: 600;
        }

        .form-group {
            margin-bottom: var(--space-16);
        }

        label {
            display: block;
            font-weight: 500;
            margin-bottom: var(--space-8);
            font-size: var(--font-size-base);
        }

        .required {
            color: var(--color-error);
            margin-left: var(--space-4);
        }

        input[type="text"],
        input[type="number"],
        input[type="password"],
        textarea,
        select {
            width: 100%;
            padding: var(--space-12);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            font-size: var(--font-size-base);
            background-color: var(--color-background);
            color: var(--color-text);
            font-family: inherit;
        }

        textarea {
            min-height: 150px;
            resize: vertical;
            font-family: monospace;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(33, 128, 141, 0.1);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-12) var(--space-20);
            border-radius: var(--radius-base);
            font-size: var(--font-size-base);
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 150ms cubic-bezier(0.16, 1, 0.3, 1);
            gap: var(--space-8);
        }

        .btn:focus-visible {
            outline: 2px solid var(--color-primary);
            outline-offset: 2px;
        }

        .btn--primary {
            background: var(--color-primary);
            color: var(--color-btn-primary-text);
        }

        .btn--primary:hover {
            background: var(--color-primary-hover);
        }

        .btn--primary:active {
            background: var(--color-primary-active);
        }

        .btn--secondary {
            background: rgba(94, 82, 64, 0.12);
            color: var(--color-text);
        }

        .btn--secondary:hover {
            background: rgba(94, 82, 64, 0.2);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn--full {
            width: 100%;
        }

        .preview {
            background-color: var(--color-background);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-base);
            padding: var(--space-16);
            margin-top: var(--space-16);
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: monospace;
            font-size: 12px;
            color: var(--color-text-secondary);
        }

        .status {
            padding: var(--space-12) var(--space-16);
            border-radius: var(--radius-base);
            font-size: var(--font-size-base);
            margin-top: var(--space-16);
            display: none;
        }

        .status.show {
            display: block;
        }

        .status--success {
            background-color: rgba(33, 128, 141, 0.15);
            color: var(--color-success);
            border: 1px solid rgba(33, 128, 141, 0.25);
        }

        .status--error {
            background-color: rgba(192, 21, 47, 0.15);
            color: var(--color-error);
            border: 1px solid rgba(192, 21, 47, 0.25);
        }

        .output-section {
            margin-top: var(--space-24);
        }

        .output-section h3 {
            margin: 0 0 var(--space-12) 0;
            font-size: var(--font-size-lg);
            font-weight: 600;
        }

        .download-btn {
            margin-top: var(--space-12);
        }

        .info-box {
            background-color: rgba(33, 128, 141, 0.1);
            border-left: 3px solid var(--color-primary);
            padding: var(--space-12) var(--space-16);
            border-radius: var(--radius-base);
            margin-bottom: var(--space-16);
            font-size: var(--font-size-base);
        }

        .info-box strong {
            display: block;
            margin-bottom: var(--space-4);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìù –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä TXT ‚Üí MD –¥–ª—è –î–∑–µ–Ω–∞</h1>
        <p class="subtitle">–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–µ–π –≤ Markdown —Å front-matter. –ö–∞–∂–¥–∞—è —Å—Ç–∞—Ç—å—è –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è!</p>

        <div class="grid">
            <!-- INPUT CARD -->
            <div class="card">
                <h2>1Ô∏è‚É£ –ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>

                <div class="form-group">
                    <label for="title">üìå –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–∞—Ç—å–∏</label>
                    <input type="text" id="title" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú—É—á–∏—Ç–µ–ª—å–Ω—ã–π —Å—Ç—ã–¥ 20 –ª–µ—Ç –¥–∞–≤–∏–ª –Ω–∞ –º–µ–Ω—è">
                </div>

                <div class="form-group">
                    <label for="year">üìÖ –ì–æ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</label>
                    <input type="number" id="year" value="2025" min="2020" max="2030">
                </div>

                <div class="form-group">
                    <label for="month">üìÜ –ú–µ—Å—è—Ü (01-12)</label>
                    <input type="number" id="month" value="12" min="1" max="12">
                </div>

                <div class="form-group">
                    <label for="day">üóìÔ∏è –î–µ–Ω—å</label>
                    <input type="number" id="day" value="1" min="1" max="31">
                </div>

                <div class="form-group">
                    <label for="imageName">üñºÔ∏è –ò–º—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–ë–ï–ó —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è) <span class="required">*</span></label>
                    <input type="text" id="imageName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: fear-story (–±—É–¥–µ—Ç fear-story.jpg)" required>
                    <small style="color: var(--color-text-secondary);">‚ö†Ô∏è –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û! –ö–∞–∂–¥–∞—è —Å—Ç–∞—Ç—å—è –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è!</small>
                </div>

                <div class="form-group">
                    <label for="category">üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏—è –î–∑–µ–Ω–∞ <span class="required">*</span></label>
                    <select id="category" required>
                        <option value="lifestory" selected>lifestory - –ò—Å—Ç–æ—Ä–∏–∏ –∏–∑ –∂–∏–∑–Ω–∏</option>
                        <option value="article">article - –°—Ç–∞—Ç—å–∏ –∏ –∞–Ω–∞–ª–∏–∑</option>
                        <option value="story">story - –†–∞—Å—Å–∫–∞–∑—ã</option>
                        <option value="experience">experience - –û–ø—ã—Ç –∏ —Å–æ–≤–µ—Ç—ã</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="content">üìÑ –¢–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏</label>
                    <textarea id="content" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏ –∑–¥–µ—Å—å..."></textarea>
                </div>

                <div class="form-group">
                    <label for="apiKey">üîë Gemini API Key (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è)</label>
                    <input type="password" id="apiKey" placeholder="sk-...">
                </div>

                <button class="btn btn--primary btn--full" id="convertBtn">
                    üöÄ –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å
                </button>
            </div>

            <!-- OUTPUT CARD -->
            <div class="card">
                <h2>2Ô∏è‚É£ –†–µ–∑—É–ª—å—Ç–∞—Ç</h2>

                <div id="status" class="status"></div>

                <div id="descriptionSection" style="display: none;">
                    <div class="form-group">
                        <label>üìù –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea id="description" readonly style="background-color: var(--color-gray-200);"></textarea>
                    </div>
                </div>

                <div id="previewSection" style="display: none;">
                    <div class="output-section">
                        <h3>üìã Front-Matter</h3>
                        <div class="preview" id="previewMatter"></div>
                        <button class="btn btn--secondary download-btn" id="copyBtn">
                            üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å front-matter
                        </button>
                    </div>

                    <div class="output-section">
                        <h3>üì∞ –ü–æ–ª–Ω—ã–π Markdown</h3>
                        <div class="preview" id="previewFull"></div>
                        <button class="btn btn--secondary download-btn" id="downloadBtn">
                            üíæ –°–∫–∞—á–∞—Ç—å .md —Ñ–∞–π–ª
                        </button>
                    </div>

                    <div class="info-box">
                        <strong>‚úÖ –ì–æ—Ç–æ–≤–æ!</strong>
                        <span>GitHub RAW URL –≥–æ—Ç–æ–≤. –ó–∞–≥—Ä—É–∂–∞–π—Ç–µ —Å—Ç–∞—Ç—å—é –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ articles/published/2025/12/21/</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const titleInput = document.getElementById('title');
        const yearInput = document.getElementById('year');
        const monthInput = document.getElementById('month');
        const dayInput = document.getElementById('day');
        const imageNameInput = document.getElementById('imageName');
        const categoryInput = document.getElementById('category');
        const contentInput = document.getElementById('content');
        const apiKeyInput = document.getElementById('apiKey');
        const convertBtn = document.getElementById('convertBtn');
        const statusEl = document.getElementById('status');
        const previewSection = document.getElementById('previewSection');
        const descriptionSection = document.getElementById('descriptionSection');
        const descriptionInput = document.getElementById('description');
        const previewMatter = document.getElementById('previewMatter');
        const previewFull = document.getElementById('previewFull');
        const copyBtn = document.getElementById('copyBtn');
        const downloadBtn = document.getElementById('downloadBtn');

        async function generateDescription(content) {
            const apiKey = apiKeyInput.value.trim();
            if (!apiKey) {
                return content.substring(0, 150).replace(/\n/g, ' ') + '...';
            }

            try {
                const context = content.substring(0, 500);
                const response = await fetch(
                    'https://generativelanguage.googleapis.com/v1/models/gemini-pro:generateContent?key=' + apiKey,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: `–¢—ã –ø–∏—à–µ—à—å –∏–Ω—Ç—Ä–∏–≥—É—é—â–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è –¥–ª—è –Ø–Ω–¥–µ–∫—Å.–î–∑–µ–Ω–∞. 
–°–¢–ê–¢–¨–Ø:
${context}

–ù–∞–ø–∏—à–∏ –∏–Ω—Ç—Ä–∏–≥—É—é—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤ —Å—Ç–∏–ª–µ –î–∑–µ–Ω–∞ (150-200 —Å–∏–º–≤–æ–ª–æ–≤). –ù–∞—á–Ω–∏ —Å –≥–ª–∞–≥–æ–ª–∞ –∏–ª–∏ –≤–æ–ø—Ä–æ—Å–∞. –ë–ï–ó –∫–∞–≤—ã—á–µ–∫!
–ü—Ä–∏–º–µ—Ä: "–†–∞—Å–∫—Ä—ã—Ç—å —Å–µ–∫—Ä–µ—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ö—Ä–∞–Ω–∏—Ç –∫–∞–∂–¥—ã–π —É—Å–ø–µ—à–Ω—ã–π —á–µ–ª–æ–≤–µ–∫"
–¢–û–õ–¨–ö–û –û–ü–ò–°–ê–ù–ò–ï, –ë–ï–ó –î–û–ü –¢–ï–ö–°–¢–ê!`
                                }]
                            }]
                        })
                    }
                );

                if (!response.ok) {
                    console.error('API error:', await response.text());
                    return content.substring(0, 150).replace(/\n/g, ' ') + '...';
                }

                const data = await response.json();
                return data.candidates[0].content.parts[0].text.trim();
            } catch (err) {
                console.error('Error generating description:', err);
                return content.substring(0, 150).replace(/\n/g, ' ') + '...';
            }
        }

        function escapeYaml(str) {
            if (!str) return '""';
            if (str.includes('"') || str.includes('\n')) {
                return '"' + str.replace(/"/g, '\\"') + '"';
            }
            return '"' + str + '"';
        }

        function pad(num) {
            return String(num).padStart(2, '0');
        }

        function showStatus(message, type) {
            statusEl.textContent = message;
            statusEl.className = 'status show status--' + type;
        }

        convertBtn.addEventListener('click', async () => {
            const title = titleInput.value.trim();
            const year = yearInput.value.trim();
            const month = pad(monthInput.value);
            const day = pad(dayInput.value);
            const imageName = imageNameInput.value.trim();
            const category = categoryInput.value.trim();
            const content = contentInput.value.trim();

            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!title || !content) {
                showStatus('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏', 'error');
                return;
            }

            if (!imageName) {
                showStatus('‚ùå –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û —É–∫–∞–∂–∏—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è! (–Ω–∞–ø—Ä–∏–º–µ—Ä: fear-story)', 'error');
                convertBtn.disabled = false;
                return;
            }

            convertBtn.disabled = true;
            showStatus('‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞...', 'success');

            try {
                const description = await generateDescription(content);
                descriptionInput.value = description;
                descriptionSection.style.display = 'block';

                const date = `${year}-${month}-${day}`;
                const imagePath = `${imageName}.jpg`;
                
                // GitHub raw URL –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ published –ø–∞–ø–∫–µ
                const dirPath = `${year}/${month}/${day}`;
                const imageUrl = `https://raw.githubusercontent.com/crosspostly/dzen/main/articles/published/${dirPath}/${imagePath}`;

                // Front-matter —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç content —á–µ—Ä–µ–∑ —à–∞–±–ª–æ–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏
                const frontMatter = `---
title: ${escapeYaml(title)}
date: ${date}
description: ${escapeYaml(description)}
image: "${imageUrl}"
category: "${category}"
---

${content}`;

                previewMatter.textContent = frontMatter;
                previewFull.textContent = frontMatter;
                previewSection.style.display = 'block';

                showStatus('‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! GitHub RAW URL —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.', 'success');

                copyBtn.onclick = () => {
                    navigator.clipboard.writeText(frontMatter).then(() => {
                        showStatus('‚úÖ –ü–æ–ª–Ω—ã–π markdown —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞', 'success');
                    });
                };

                downloadBtn.onclick = () => {
                    const blob = new Blob([frontMatter], { type: 'text/markdown' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${title.replace(/\s+/g, '-').toLowerCase()}-${date}.md`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    showStatus('üíæ –§–∞–π–ª —Å–∫–∞—á–∞–Ω!', 'success');
                };
            } catch (err) {
                showStatus('‚ùå –û—à–∏–±–∫–∞: ' + err.message, 'error');
            } finally {
                convertBtn.disabled = false;
            }
        });

        contentInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && e.ctrlKey) {
                convertBtn.click();
            }
        });
    </script>
</body>
</html>
