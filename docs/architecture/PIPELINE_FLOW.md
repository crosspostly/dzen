# üèó ZenMaster Pipeline Flow (v7.0)

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–æ–ª–Ω—ã–π –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å—Ç–∞—Ç—å–∏ –æ—Ç –∏–¥–µ–∏ –¥–æ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏. 

---

## üó∫ –û–±—â–∞—è —Å—Ö–µ–º–∞ (Data Flow)

1. **Theme Generation** (`ThemeGeneratorService`)
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—É—é —Ç–µ–º—É –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç—Ä–µ–Ω–¥–æ–≤ –∏–ª–∏ –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –≤–µ–∫—Ç–æ—Ä–∞.
2. **Stage 0: PlotBible** (`PlotBibleBuilder`)
   - **Visual DNA:** –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç –¥–ª—è –æ–±–ª–æ–∂–∫–∏.
   - **Narrator Profile:** –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≥–æ–ª–æ—Å, –≤–æ–∑—Ä–∞—Å—Ç –∏ –ø—Ä–∏–≤—ã—á–∫–∏ –∞–≤—Ç–æ—Ä–∞.
   - **Archetype:** –í—ã–±–∏—Ä–∞–µ—Ç —Å—Ü–µ–Ω–∞—Ä–Ω—É—é –º–æ–¥–µ–ª—å (–Ω–∞–ø—Ä. "–ó–æ–ª–æ—Ç–∞—è –ª–æ–≤—É—à–∫–∞").
3. **Stage 1: Multi-Agent Episode Generation** (`MultiAgentService`)
   - 12 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ –ø–∏—à—É—Ç —ç–ø–∏–∑–æ–¥—ã.
   - –ö–∞–∂–¥—ã–π –∞–≥–µ–Ω—Ç –∑–Ω–∞–µ—Ç —Å–≤–æ—é —Ä–æ–ª—å –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏ (—á–µ—Ä–µ–∑ PlotBible).
4. **Stage 2: Assembly & Sanitization** (`ContentSanitizer`)
   - –°–±–æ—Ä–∫–∞ —ç–ø–∏–∑–æ–¥–æ–≤ –≤ –µ–¥–∏–Ω—ã–π Markdown.
   - –£–¥–∞–ª–µ–Ω–∏–µ –º—É—Å–æ—Ä–∞ ([note], [TODO], –ª–∏—à–Ω–∏–µ –ø–µ—Ä–µ–Ω–æ—Å—ã).
   - –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏–∞–ª–æ–≥–æ–≤ (—Ç–∏—Ä–µ).
5. **Stage 3: Visual Identity** (`ImageGeneratorAgent`)
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–±–ª–æ–∂–∫–∏ –ø–æ Visual DNA –∏–∑ Stage 0.
   - –ü–æ—Å—Ç-–æ–±—Ä–∞–±–æ—Ç–∫–∞: Magic Bytes (JPG/PNG/WebP) + Mobile Photo Authenticity.
6. **Stage 4: Anti-Detection (Optional)** (`Phase2AntiDetectionService`)
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Perplexity –∏ Burstiness.
   - Adversarial Gatekeeper: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ "—Ä–æ–±–æ—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å".
7. **Stage 5: Publishing (Playwright)** (`!posts/zen_auto_publisher.js`)
   - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Å–µ—Å—Å–∏—é (cookies).
   - –≠–º—É–ª—è—Ü–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è —á–µ–ª–æ–≤–µ–∫–∞.
   - –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—Å—Ç–∞ –∏ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä –î–∑–µ–Ω–∞.

---

## ü§ñ –ú—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞ (MultiAgentService)

–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É **Shared Context**:
- **PlotBible** –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∫–∞–∂–¥–æ–º—É –∞–≥–µ–Ω—Ç—É.
- –ê–≥–µ–Ω—Ç—ã –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø–∏—à—É—Ç —Ç–µ–∫—Å—Ç, –æ–Ω–∏ "–æ—Ç—ã–≥—Ä—ã–≤–∞—é—Ç" —Ä–æ–ª—å, –∑–∞–¥–∞–Ω–Ω—É—é –≤ –ø—Ä–æ—Ñ–∏–ª–µ —Ä–∞—Å—Å–∫–∞–∑—á–∏–∫–∞ (`NarratorProfile`).
- **Archetypes (v8.0):** –ü–æ–∑–≤–æ–ª—è—é—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏–∏ —Å –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ –≤—ã—Å–æ–∫–∏–º CTR (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–Ω—ã–µ —Ö–æ–¥—ã).

---

## üé≠ –ü—É–±–ª–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Playwright

–°–∫—Ä–∏–ø—Ç –≤ `!posts/zen_auto_publisher.js` ‚Äî —ç—Ç–æ "—Ä—É–∫–∏" —Å–∏—Å—Ç–µ–º—ã.

**–ê–ª–≥–æ—Ä–∏—Ç–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ —Å–±–æ—è—Ö:**
1. **Cookies:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª `cookies.json`. –ï—Å–ª–∏ —Å–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞, –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –∫—É–∫–∏ –≤—Ä—É—á–Ω—É—é –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å.
2. **Selectors:** –Ø–Ω–¥–µ–∫—Å —á–∞—Å—Ç–æ –º–µ–Ω—è–µ—Ç –≤–µ—Ä—Å—Ç–∫—É. –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
   - `input[placeholder*="title"]` (–ó–∞–≥–æ–ª–æ–≤–æ–∫)
   - `[contenteditable="true"]` (–ü–æ–ª–µ —Ç–µ–∫—Å—Ç–∞)
   - –ö–Ω–æ–ø–∫–∞ "–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å".
3. **Waiters:** –°–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `networkidle` –∏ `waitForSelector`. –ï—Å–ª–∏ –î–∑–µ–Ω —Ç–æ—Ä–º–æ–∑–∏—Ç, –Ω—É–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å —Ç–∞–π–º–∞—É—Ç—ã.

---

## üìÇ –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

- **–õ–æ–≥–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:** `services/multiAgentService.ts`
- **–ü–ª–∞–Ω –∏—Å—Ç–æ—Ä–∏–∏:** `services/plotBibleBuilder.ts`
- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–∏–Ω–æ–∫:** `services/imageGeneratorAgent.ts`
- **–ü—É–±–ª–∏–∫–∞—Ç–æ—Ä:** `!posts/PRODUCTION_READY/src/main.js.ci`
- **–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –±—é–¥–∂–µ—Ç–∞:** `constants/BUDGET_CONFIG.ts`

---

## ‚öôÔ∏è CI/CD –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è (GitHub Actions)

–ü—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–±–∏—Ç –Ω–∞ —Ç—Ä–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö, –Ω–æ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö workflow –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö.

### 1. –§–∞–±—Ä–∏–∫–∞ –ö–æ–Ω—Ç–µ–Ω—Ç–∞ (`content-factory.yml`)
**–¢—Ä–∏–≥–≥–µ—Ä:** –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ (05:00 UTC) –∏–ª–∏ –≤—Ä—É—á–Ω—É—é.
**–ó–∞–¥–∞—á–∞:** –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞.
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Ç–∞—Ç—å–∏ (—Ç–µ–∫—Å—Ç + —Ñ–æ—Ç–æ).
- –ó–∞–ø—É—Å–∫–∞–µ—Ç **Auto-Restore** (–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∏—Ç—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤).
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–∞–π–ª—ã (`.md`, `.jpg`) –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.
- **–í–ê–ñ–ù–û:** –ù–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç RSS —Ñ–∏–¥ –Ω–∞–ø—Ä—è–º—É—é, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤.

### 2. –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä RSS (`generate-feed.yml`)
**–¢—Ä–∏–≥–≥–µ—Ä:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è `content-factory.yml` (`workflow_run`).
**–ó–∞–¥–∞—á–∞:** –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–µ–Ω—Ç—ã –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ç–æ—Ä–∞.
- –°–∫–∞–Ω–∏—Ä—É–µ—Ç –ø–∞–ø–∫—É `articles/`.
- –î–æ–±–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –≤–∞–ª–∏–¥–Ω—ã–µ —Å—Ç–∞—Ç—å–∏ (—Å —Ñ–æ—Ç–æ –∏ –¥–∞—Ç–æ–π).
- –§–æ—Ä–º–∏—Ä—É–µ—Ç `public/feed.xml` —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –ø—É–±–ª–∏–∫–∞—Ü–∏–∏.
- –ö–æ–º–º–∏—Ç–∏—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ñ–∏–¥.

### 3. –ê–≤—Ç–æ-–ü—É–±–ª–∏–∫–∞—Ç–æ—Ä (`auto-publish-dzen.yml`)
**–¢—Ä–∏–≥–≥–µ—Ä:** –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ (–∫–∞–∂–¥—ã–µ 3 —á–∞—Å–∞).
**–ó–∞–¥–∞—á–∞:** –î–æ—Å—Ç–∞–≤–∫–∞ –≤ –î–∑–µ–Ω.
- –ß–∏—Ç–∞–µ—Ç `public/feed.xml`.
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –≤ `published_articles.txt`.
- –ï—Å–ª–∏ –Ω–∞—Ö–æ–¥–∏—Ç –Ω–æ–≤—É—é —Å—Ç–∞—Ç—å—é ‚Äî –ø—É–±–ª–∏–∫—É–µ—Ç (Anti-Detect v2.0).
- –û–±–Ω–æ–≤–ª—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é.
