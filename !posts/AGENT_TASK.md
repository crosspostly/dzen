# Задание для агента по автоматизации публикации в Дзен

## Основная задача

Создать полностью автоматизированный публишер для Яндекс Дзен, который:
1. Читает статьи из `public/feed.xml`
2. Заполняет заголовок и тело статьи (с полным текстом и обработкой HTML-тегов)
3. Вставляет изображение из фида
4. Нажимает Enter после вставки тела статьи
5. Нажимает кнопку публикации (в редакторе статьи)
6. Нажимает кнопку подтверждения публикации (в модальном окне)
7. Использует точные селекторы из `dzen-schema.json`

## Последовательность действий

### 1. Подготовка
- Загрузка куки из `./config/cookies.json`
- Открытие браузера с нужными настройками
- Переход на `https://dzen.ru/profile/editor/potemki`

### 2. Запуск редактора статьи
- Нажатие кнопки "Создать публикацию" (селектор: `[data-testid="add-publication-button"]`)
- Нажатие кнопки "Написать статью" (текст: `"Написать статью"`)
- Закрытие всплывающего окна помощи

### 3. Заполнение статьи (очень важно!)
- **Сначала** заполняем заголовок (в первое доступное поле)
- **Затем** заполняем тело статьи (во второе доступное поле)
- Обязательно нажимаем **Enter** после вставки тела статьи

### 4. Вставка изображения
- Используем точный селектор: `button.article-editor-desktop--side-button__sideButton-1z[data-tip="Вставить изображение"]`
- Вставляем URL изображения из фида

### 5. Публикация (2 шага!)
- **Шаг 1**: Нажатие первой кнопки публикации в редакторе статьи:
  - Точный селектор: `html._theme_white.Theme_color_light > body.page.desktop > div.content:nth-of-type(2) > div.article-editor-desktop--loading-boundary-stacked-layout__boundary-2W:nth-of-type(2) > div.article-editor-desktop--loading-boundary-stacked-layout__content-3p > div:nth-of-type(2) > div.article-editor-desktop--editor-header__editorHeader-2q.article-editor-desktop--editor-header__hasWideScroll-1S > div.article-editor-desktop--editor-header__container-3n > div.article-editor-desktop--editor-header__colRight-3Z:nth-of-type(3) > div.article-editor-desktop--editor-header__publishButton-gc > div.article-editor-desktop--editor-header__publishBtnContainer-3D > button.article-editor-desktop--editor-header__editBtn-44.article-editor-desktop--base-button__rootElement-75`

- **Шаг 2**: Нажатие второй кнопки публикации в модальном окне:
  - Точный селектор: `button[data-testid="publish-btn"][type="submit"]`

## Важные особенности

1. **Порядок заполнения**: Заголовок → Тело статьи (не наоборот!)
2. **Проверка полей**: Убедиться, что поля заголовка и тела разные
3. **Обработка HTML-тегов**: Преобразовать теги в текст с правильными переносами строк
4. **Нажатие Enter**: После вставки тела статьи обязательно нажимается Enter
5. **Два шага публикации**: 
   - Первая кнопка в редакторе статьи
   - Вторая кнопка в модальном окне подтверждения
6. **Использование точных селекторов**: `[data-testid="publish-btn"]` и другие из dzen-schema.json

## Структура feed.xml

Файл должен содержать:
```xml
<rss version="2.0">
  <channel>
    <title>Ваш канал</title>
    <item>
      <title><![CDATA[Заголовок статьи]]></title>
      <description><![CDATA[Описание статьи]]></description>
      <content:encoded><![CDATA[Текст статьи]]></content:encoded>
      <media:content url="https://ссылка-на-изображение.jpg" type="image/jpeg"/>
      <link>https://ссылка-на-статью</link>
      <pubDate>Дата публикации</pubDate>
    </item>
  </channel>
</rss>
```

## Обработка HTML-тегов

- `<p>` → `\n\n` (двойные переносы строк)
- `<h1>-<h6>` → `\n\n` (переносы строк)
- `<div>` → `\n` (переносы строк)
- `<br>` → `\n` (переносы строк)
- `<li>` → `\n• ` (переносы строк с отступом)
- Все остальные теги удаляются, текст сохраняется
- HTML сущности заменяются на соответствующие символы

## Требования к файлам

- `config/cookies.json` - файл с куки для аутентификации
- `public/feed.xml` - RSS-фид с статьями
- `dzen-schema.json` - файл с записанными селекторами
- `package.json` - зависимости проекта

## Безопасность

- Использовать куки для аутентификации
- Не хранить пароли в открытом виде
- Работать локально
- Использовать отдельный аккаунт для автоматизации

## Примечания

- Следить за обновлениями интерфейса Дзен
- Проверять актуальность селекторов
- Использовать задержки для имитации человеческого поведения
- Обратить внимание на два шага публикации