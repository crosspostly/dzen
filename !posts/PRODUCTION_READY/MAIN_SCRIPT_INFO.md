# Описание основного скрипта (src/main.js)

## Структура скрипта

Основной скрипт `src/main.js` (переименованный из zen_auto_publisher.js) состоит из следующих основных частей:

## 1. Импорт зависимостей
- Playwright для автоматизации браузера
- File System модуль для работы с файлами
- Модуль для отслеживания истории публикаций

## 2. Функции обработки данных
- `getArticlesFromFeed()` - извлекает статьи из RSS-файла
- `processArticleContent()` - обрабатывает HTML-теги в тексте статьи
- Функции для работы с историей публикаций

## 3. Основной процесс публикации
- Загрузка куки и открытие браузера
- Навигация к редактору Дзен
- Заполнение заголовка и тела статьи
- Вставка изображения
- Двухшаговая публикация
- Сохранение информации о публикации

## Основные функции

### getArticlesFromFeed()
- Читает feed.xml
- Извлекает статьи с помощью регулярных выражений
- Возвращает массив объектов со статьями

### processArticleContent()
- Обрабатывает HTML-теги в тексте
- Заменяет теги на соответствующие переносы строк
- Удаляет остальные теги, сохраняя текст
- Заменяет HTML сущности на соответствующие символы

### Основной процесс
- Проверяет, есть ли непубликованные статьи
- Открывает браузер с нужными настройками
- Проходит через процесс публикации
- Сохраняет результаты

## Важные особенности

### Порядок действий
1. Сначала заполняется заголовок
2. Затем заполняется тело статьи
3. Нажимается Enter после тела статьи
4. Вставляется изображение
5. Нажимаются кнопки публикации (2 раза)

### Обработка HTML
- Параграфы `<p>` → двойные переносы строк `\n\n`
- Заголовки `<h1>-<h6>` → переносы строк `\n\n`
- Div-ы `<div>` → переносы строк `\n`
- BR-теги `<br>` → переносы строк `\n`
- LI-теги `<li>` → переносы строк с отступом `\n• `

### Селекторы
- Используются точные селекторы для надежного взаимодействия
- Селекторы могут быть обновлены при изменениях интерфейса

## Настройки и конфигурация

Скрипт использует следующие пути:
- `./config/cookies.json` - для аутентификации
- `./published_articles.txt` - для отслеживания публикаций
- `./dzen-schema.json` - для точных селекторов
- `./public/feed.xml` - для получения статей

## Обработка ошибок

- Проверяет наличие файлов
- Обрабатывает ошибки загрузки
- Продолжает работу при ошибках отдельных статей
- Показывает информативные сообщения об ошибках