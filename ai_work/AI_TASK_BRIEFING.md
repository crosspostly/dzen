# ü§ñ –ó–ê–î–ê–ù–ò–ï –î–õ–Ø –ò–ò: –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–¥–µ–ª–∫–∞ ZenMaster —Å–∏—Å—Ç–µ–º—ã

**–°—Ç–∞—Ç—É—Å**: üî¥ –ö–†–ò–¢–ò–ß–ù–´–ô  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –ú–ê–ö–°–ò–ú–£–ú  
**–î–µ–¥–ª–∞–π–Ω**: –ê–°–ê–ü  
**–ö–æ–Ω—Ç–µ–∫—Å—Ç**: –°–∏—Å—Ç–µ–º–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Ç–∞—Ç—å–∏ –Ω–∞ 15,000+ –∑–Ω–∞–∫–æ–≤, –Ω–æ –∫–∞—á–µ—Å—Ç–≤–æ –ø–∞–¥–∞–µ—Ç –∏–∑-–∑–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –æ—à–∏–±–æ–∫.

---

## üìå –ö–†–ê–¢–ö–û: –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

```
–ë–´–õ–û:                           –°–¢–ê–ù–ï–¢:
- 5 —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤            ‚Üí 1 —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–º–ø—Ç–æ–≤
- Cleanup –ø–æ—Ä—Ç–∏—Ç —Å—Ç–∞—Ç—å–∏        ‚Üí Auto-restore –∂–∏–≤–æ–π
- –î—É–±–ª–∏ —ç–ø–∏–∑–æ–¥–æ–≤              ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
- –ù–µ—Ç Phase2 –∫–æ–Ω—Ç—Ä–æ–ª—è          ‚Üí Quality gate –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ
- –ü–∞—Ä—Å–∏–Ω–≥ –ø–∞–¥–∞–µ—Ç              ‚Üí Graceful fallback
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°—Ç–∞—Ç—å–∏ –≤—ã—Å–æ–∫–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ —Å Phase2 Score 75+

---

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –°–ò–°–¢–ï–ú–´ (—Ç–µ–∫—É—â–∞—è)

### –≠—Ç–∞–ø—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:

```
STAGE 0: Plan Creation (5 –º–∏–Ω)
‚îú‚îÄ INPUT: –¢–µ–º–∞
‚îú‚îÄ OUTPUT: PlotBible JSON
‚îî‚îÄ –ü–†–û–ë–õ–ï–ú–ê: –ü–∞—Ä—Å–∏–Ω–≥ –ø–∞–¥–∞–µ—Ç ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è default

STAGE 1: Episode Writing (15 –º–∏–Ω)
‚îú‚îÄ INPUT: PlotBible JSON
‚îú‚îÄ OUTPUT: 7-12 .md —Ñ–∞–π–ª–æ–≤
‚îú‚îÄ –ü–†–û–ë–õ–ï–ú–ê 1: –≠–ø–∏–∑–æ–¥—ã –º–æ–≥—É—Ç –±—ã—Ç—å –¥—É–±–ª—è–º–∏
‚îî‚îÄ –ü–†–û–ë–õ–ï–ú–ê 2: –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ (Phase2 Score)

STAGE 2: Article Assembly (10 –º–∏–Ω)
‚îú‚îÄ INPUT: 7-12 —ç–ø–∏–∑–æ–¥–æ–≤
‚îú‚îÄ OUTPUT: –°–æ–±—Ä–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç—å—è
‚îú‚îÄ –ü–†–û–ë–õ–ï–ú–ê: –ö–æ–ø–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç STAGE 1 –≤–º–µ—Å—Ç–æ –ø–µ—Ä–µ–ø–∏—Å–∏
‚îî‚îÄ –ü–†–û–ë–õ–ï–ú–ê: –ù–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å PlotBible

STAGE 3: Voice Restoration (5 –º–∏–Ω) ‚Üê –ö–†–ò–¢–ò–ß–ù–´–ô –®–ê–ì
‚îú‚îÄ INPUT: –°–æ–±—Ä–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç—å—è
‚îú‚îÄ OUTPUT: RESTORED —Å—Ç–∞—Ç—å—è (—ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è)
‚îú‚îÄ –ö–û–î: services/voiceRestorationService.ts (–Ω–æ–≤—ã–π)
‚îú‚îÄ –¶–ï–õ–¨: –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å RAW ‚Üí RESTORED –¥–ª—è A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îî‚îÄ –†–ï–ó–£–õ–¨–¢–ê–¢: 2 –≤–µ—Ä—Å–∏–∏ (RAW + RESTORED) –¥–ª—è –≤—ã–±–æ—Ä–∞

GITHUB WORKFLOW: Auto-Restore (–∫–∞–∂–¥—É—é –Ω–æ—á—å) ‚Üê –°–ü–ê–°–ê–¢–ï–õ–¨
‚îú‚îÄ INPUT: –£–∂–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç—å–∏ (articles/*.md)
‚îú‚îÄ PROCESS: scripts/restore-articles.js
‚îú‚îÄ –¶–ï–õ–¨: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —á–∏—Å—Ç–∫–∞ (—É–¥–∞–ª—è–µ—Ç –º—É—Å–æ—Ä, –æ—Ñ–æ—Ä–º–ª—è–µ—Ç)
‚îî‚îÄ OUTPUT: –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∞—Ç—å–∏ (Phase2 75+)
```

---

## üéØ –†–ê–ó–î–ï–õ–ï–ù–ò–ï –û–¢–í–ï–¢–°–¢–í–ï–ù–ù–û–°–¢–ò (–ö–†–ò–¢–ò–ß–ù–û!)

### ‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–µ: –î–≤–∞ —Ä–∞–∑–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–∞, –Ω–µ –ø—É—Ç–∞—Ç—å!

| STAGE 3: Voice Restoration | Auto-Restore Workflow |
|:---|:---|
| **–ö–æ–≥–¥–∞**: –í–æ –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (STAGE 3) | **–ö–æ–≥–¥–∞**: –ö–∞–∂–¥—É—é –Ω–æ—á—å –Ω–∞ GitHub |
| **–ì–¥–µ**: `services/voiceRestorationService.ts` | **–ì–¥–µ**: `.github/workflows/auto-restore-articles.yml` |
| **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç**: RAW ‚Üí RESTORED (—ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Ç—Ä–∞–Ω—Å—Ñ–æ | **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç**: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —á–∏—Å—Ç–∫–∞ —É–∂–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö |
| **Input**: –°–æ–±—Ä–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç—å—è (18-20K –∑–Ω–∞–∫–æ–≤) | **Input**: –§–∞–π–ª—ã –≤ `articles/` (—Å Phase2 Score) |
| **Output**: RESTORED –≤–µ—Ä—Å–∏—è (+15-50% —ç–º–æ—Ü–∏–∏) | **Output**: –ß–∏—Å—Ç–∫–∞ (—É–¥–∞–ª—è–µ—Ç –º—É—Å–æ—Ä, –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç –≤–µ—Ä—Å—Ç–∫—É) |
| **–ü—Ä–æ–º–ø—Ç**: 6-stage transformation | **–°–∫—Ä–∏–ø—Ç**: Chunked mode (3000 –∑–Ω–∞–∫–æ–≤ –Ω–∞ –∫—É—Å–æ–∫) |
| **–¶–µ–ª—å**: A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ RAW vs RESTORED | **–¶–µ–ª—å**: –£–ª—É—á—à–µ–Ω–∏–µ –Ω–∏–∑–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π |
| **–ö–æ–≥–¥–∞ —É—Å–ø–µ—à–Ω–∞**: Phase2 RAW 68 ‚Üí RESTORED 84 | **–ö–æ–≥–¥–∞ —É—Å–ø–µ—à–Ω–∞**: Phase2 –±—ã–ª–æ 52 ‚Üí —Å—Ç–∞–ª–æ 78 |

---

## ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –û–®–ò–ë–ö–ò

### –û—à–∏–±–∫–∞ 1: –ü–∞—Ä—Å–∏–Ω–≥ PlotBible

**–ì–¥–µ**: `src/services/stage-0/generate-plotbible.ts`

**–ü—Ä–æ–±–ª–µ–º–∞**:
```typescript
const bible = parseJSON(response)
if (!bible) useDefault()  // ‚Üê –°–ú–ï–†–¢–¨: default bible –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏–µ**: –°—Ç–∞—Ç—å—è –ø—Ä–æ 25-–ª–µ—Ç–Ω—é—é, –Ω–æ —Ç–µ–º–∞ –ø—Ä–æ 50-–ª–µ—Ç–Ω—é—é

**–†–µ—à–µ–Ω–∏–µ**: –ù–µ –ø–∞—Ä—Å–∏—Ç—å, –≤–∑—è—Ç—å –∫–∞–∫ —Ç–µ–∫—Å—Ç
```typescript
const biblesText = response  // –í–∑—è—Ç—å –∫–∞–∫ –µ—Å—Ç—å
// –ï—Å–ª–∏ JSON - fine, –µ—Å–ª–∏ —Ç–µ–∫—Å—Ç - —Ç–æ–∂–µ fine
// –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å –î–ê–õ–¨–®–ï –∫–∞–∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç, –Ω–µ –∫–∞–∫ JSON
```

---

### –û—à–∏–±–∫–∞ 2: Cleanup –ø–æ—Ä—Ç–∏—Ç —Å—Ç–∞—Ç—å–∏

**–ì–¥–µ**: `src/services/stage-3/cleanup.ts` ‚Üê –≠–¢–û–¢ –§–ê–ô–õ –£–î–ê–õ–ò–¢–¨!

**–ü—Ä–æ–±–ª–µ–º–∞**:
```typescript
// –£–¥–∞–ª—è–µ—Ç "–ë–æ–∂–µ"
const cleaned = text.replace(/–ë–æ–∂–µ|–º–∞–º–∞|—Å–ø–∞—Å–∏—Ç–µ/gi, '')

// –£–¥–∞–ª—è–µ—Ç –Ω—É–∂–Ω—ã–µ –∑–∞–ø—è—Ç—ã–µ
const normalized = text.replace(/,\s+/g, ' ')  // ‚Üê KILL

// –†–µ–∑—É–ª—å—Ç–∞—Ç: "–ë–æ–∂–µ –∫–∞–∫ —è –±—ã–ª–∞ –≥–ª—É–ø–∞" ‚Üí "–∫–∞–∫ —è –±—ã–ª–∞ –≥–ª—É–ø–∞"
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏–µ**: –¢–µ—Ä—è–µ—Ç—Å—è —ç–º–æ—Ü–∏—è, —Å—Ç–∞—Ç—å—è –∑–≤—É—á–∏—Ç —Ä–æ–±–æ—Ç–Ω–æ

**–†–µ—à–µ–Ω–∏–µ**: –£–¥–∞–ª–∏—Ç—å cleanup.ts, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ:
1. **STAGE 3**: VoiceRestorationService (–Ω–æ–≤–æ–µ)
2. **–ù–æ—á—å—é**: Auto-Restore workflow (—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ)

---

### –û—à–∏–±–∫–∞ 3: –î—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —ç–ø–∏–∑–æ–¥—ã

**–ì–¥–µ**: `src/services/stage-1/generate-episodes.ts`

**–ü—Ä–æ–±–ª–µ–º–∞**:
```typescript
for (let i = 0; i < 7; i++) {
  const episode = await generateEpisode()
  // –ù–ï –ü–†–û–í–ï–†–Ø–ï–¢: —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç–ø–∏–∑–æ–¥ –¥—É–±–ª–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ
  episodes.push(episode)  // PUSH –ë–ï–ó –ü–†–û–í–ï–†–ö–ò
}
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏–µ**:
```
–≠–ø–∏–∑–æ–¥ 3: "–ö–æ–≥–¥–∞ –º—É–∂ —É—à—ë–ª..."
–≠–ø–∏–∑–æ–¥ 5: "–ö–æ–≥–¥–∞ –º—É–∂ —É—à—ë–ª..." ‚Üê –î–£–ë–õ–¨!
```

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ Levenshtein distance

---

### –û—à–∏–±–∫–∞ 4: –ù–µ—Ç Phase2 –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞ —ç—Ç–∞–ø–∞—Ö

**–ì–¥–µ**: –í–µ–∑–¥–µ (–Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)

**–ü—Ä–æ–±–ª–µ–º–∞**:
```
STAGE 1 –≤—ã–¥–∞—ë—Ç —ç–ø–∏–∑–æ–¥ —Å Phase2 Score 45
‚Üì (–ë–ï–ó –ü–†–û–í–ï–†–ö–ò)
STAGE 2 —Å–æ–±–∏—Ä–∞–µ—Ç –µ–≥–æ
‚Üì (–ë–ï–ó –ü–†–û–í–ï–†–ö–ò)
STAGE 3 –ø—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–∏—Ç—å (–ù–û –£–ñ–ï –ü–û–ó–î–ù–û)
‚Üì
–í –±–∞–∑—É –ø–æ–ø–∞–¥–∞–µ—Ç –≥–æ–≤–Ω–æ
```

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–∏—Ç—å Quality Gate –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞

---

### –û—à–∏–±–∫–∞ 5: –î—É–±–ª–∏ –≤ –∫–æ–¥–µ

**–ì–¥–µ**: –í–µ–∑–¥–µ

**–ü—Ä–æ–±–ª–µ–º—ã**:
```
cleanup.ts           ‚Üê –ñ–ò–í–û–ô (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ STAGE 3)
cleanup-old.ts       ‚Üê –ú–ï–†–¢–í–ï–¶ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
cleanup-v2.ts        ‚Üê –ú–ï–†–¢–í–ï–¶ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

‚Üì

normalizeText() –≤ cleanup.ts
normalizeText() –≤ assemble.ts
normalizeText() –≤ restore.ts

‚Üì (3 —Ä–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ = CHAOS)
```

**–†–µ—à–µ–Ω–∏–µ**: 1 —Ñ—É–Ω–∫—Ü–∏—è –≤ 1 –º–µ—Å—Ç–µ, –≤—Å–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —ç—Ç—É

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï: 5 –≠–¢–ê–ü–û–í –ü–ï–†–ï–î–ï–õ–ö–ò

### –≠–¢–ê–ü A: –ü—Ä–æ–º–ø—Ç—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã

**–§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è**:

```
prompts/
‚îú‚îÄ‚îÄ stage-0-plan.md           ‚Üê –ü—Ä–æ–º–ø—Ç –¥–ª—è STAGE 0
‚îú‚îÄ‚îÄ stage-1-episodes.md       ‚Üê –ü—Ä–æ–º–ø—Ç –¥–ª—è STAGE 1
‚îú‚îÄ‚îÄ stage-2-assemble.md       ‚Üê –ü—Ä–æ–º–ø—Ç –¥–ª—è STAGE 2
‚îú‚îÄ‚îÄ stage-3-restore.md        ‚Üê –ü—Ä–æ–º–ø—Ç –¥–ª—è Voice Restoration
‚îî‚îÄ‚îÄ shared/
    ‚îú‚îÄ‚îÄ voice-guidelines.md   ‚Üê –ö–∞–∫ –¥–æ–ª–∂–Ω–∞ –∑–≤—É—á–∞—Ç—å —Å—Ç–∞—Ç—å—è
    ‚îú‚îÄ‚îÄ anti-detect.md        ‚Üê –ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å AI-–¥–µ—Ç–µ–∫—Ü–∏–∏
    ‚îú‚îÄ‚îÄ archetype-rules.md    ‚Üê 7 –∞—Ä—Ö–µ—Ç–∏–ø–æ–≤ + —Ñ–æ—Ä–º—É–ª—ã
    ‚îî‚îÄ‚îÄ quality-gates.md      ‚Üê –ö–æ–≥–¥–∞ —Å—Ç–∞—Ç—å—è —Ö–æ—Ä–æ—à–∞
```

**–°–¥–∞—á–∞**: –í—Å–µ —Ñ–∞–π–ª—ã –¥–æ–ª–∂–Ω—ã —á–∏—Ç–∞—Ç—å—Å—è –∏–∑ `fs.readFileSync()`

---

### –≠–¢–ê–ü B: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ STAGE 0

**–§–∞–π–ª**: `src/services/stage-0/generate-plotbible.ts`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:

1. **–ü–∞—Ä—Å–∏–Ω–≥ ‚Üí Graceful fallback**
```typescript
// –ë–´–õ–û (–ø–∞–¥–∞–µ—Ç):
const bible = parseJSON(response)
if (!bible) useDefault()

// –î–û–õ–ñ–ù–û (–Ω–µ –ø–∞–¥–∞–µ—Ç):
let bible
try {
  bible = JSON.parse(response)
} catch (e) {
  // –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –±–µ—Ä—ë–º –∫–∞–∫ —Å—Ç—Ä–æ–∫—É
  bible = response
}

// –ó–∞—Ç–µ–º: –ø–µ—Ä–µ–¥–∞—ë–º –¥–∞–ª—å—à–µ –∫–∞–∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç
const prompt = `
–í–æ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç–∞—Ç—å–µ:
${typeof bible === 'string' ? bible : JSON.stringify(bible)}
...`
```

2. **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤—ã–≤–æ–¥–∞**
```typescript
// –ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ PlotBible:
const validation = await validatePlotBible(bible)
if (validation.phase2Score < 65) {
  console.log('‚ö†Ô∏è PlotBible –Ω–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ, –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º...')
  bible = await restoreVoiceToJson(bible)
}
```

---

### –≠–¢–ê–ü C: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ STAGE 1

**–§–∞–π–ª**: `src/services/stage-1/generate-episodes.ts`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è**:

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ —ç–ø–∏–∑–æ–¥–æ–≤**
```typescript
const episodes = []

for (let i = 0; i < targetCount; i++) {
  let episode = await generateEpisode(plotBible)
  let attempts = 0
  
  // –ü–æ–∫–∞ –Ω–µ –±—É–¥–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–º:
  while (attempts < 3) {
    const isDuplicate = episodes.some(e => 
      levenshteinDistance(e.text, episode.text) > 0.75
    )
    
    if (isDuplicate) {
      console.log(`‚ö†Ô∏è –≠–ø–∏–∑–æ–¥ ${i} - –¥—É–±–ª—å, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∑–∞–Ω–æ–≤–æ...`)
      episode = await generateEpisode(plotBible)
      attempts++
    } else {
      break  // –£–Ω–∏–∫–∞–ª–µ–Ω, –±–µ—Ä—ë–º –µ–≥–æ
    }
  }
  
  episodes.push(episode)
}
```

2. **Quality gate –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —ç–ø–∏–∑–æ–¥–∞**
```typescript
// –ü–æ—Å–ª–µ generateEpisode:
while (episode.phase2Score < 70) {
  console.log(`‚ö†Ô∏è –≠–ø–∏–∑–æ–¥ ${i}: Phase2=${episode.phase2Score} < 70`)
  episode = await restoreVoice(episode, plotBible)
}
```

---

### –≠–¢–ê–ü D: STAGE 3 Voice Restoration (NEW!)

**–§–∞–π–ª**: `services/voiceRestorationService.ts` ‚úÖ –°–û–ó–î–ê–ù

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç**:
1. ‚úÖ –ü–∞—Ä—Å–∏—Ç RAW —Å—Ç–∞—Ç—å—é –Ω–∞ 6 —Å–µ–∫—Ü–∏–π (lede, dev, episodes, climax, resolution, finale)
2. ‚úÖ –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∫–∞–∂–¥—É—é —Å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –≥–ª—É–±–∏–Ω–æ–π
3. ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç 100% —Ñ–∞–∫—Ç–æ–≤ (–∏–º–µ–Ω–∞, –¥–∞—Ç—ã, —Å–æ–±—ã—Ç–∏—è)
4. ‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç —Å–µ–Ω—Å–æ—Ä–Ω—ã–µ –¥–µ—Ç–∞–ª–∏, –¥–∏–∞–ª–æ–≥–∏, –º–æ–Ω–æ–ª–æ–≥
5. ‚úÖ –í–∞—Ä–∏–∏—Ä—É–µ—Ç –¥–ª–∏–Ω—É –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π (Short. Medium. Longer.)
6. ‚úÖ –ò–Ω—ä–µ–∫—Ç–∏—Ä—É–µ—Ç –≥–æ–ª–æ—Å —Ä–∞—Å—Å–∫–∞–∑—á–∏–∫–∞
7. ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç RESTORED –≤–µ—Ä—Å–∏—é

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ STAGE 2**:
```typescript
// –ü–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏ RAW —Å—Ç–∞—Ç—å–∏
const rawArticle = assembleArticle(episodes, plotBible)

// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º RESTORED –≤–µ—Ä—Å–∏—é (v7.1 "both" mode)
const restorer = new VoiceRestorationService(apiKey)
const restoredArticle = await restorer.restore(rawArticle)

// Output: –æ–±–µ –≤–µ—Ä—Å–∏–∏
return {
  raw: rawArticle,
  restored: restoredArticle
}
```

**–ú–µ—Ç—Ä–∏–∫–∏ —É–ª—É—á—à–µ–Ω–∏—è**:
```
Phase2 Score:      68 ‚Üí 84 (+16 points) ‚úÖ
Sensory Details:   2 ‚Üí 15 (+650%) ‚úÖ
Est. Comments:     12 ‚Üí 38 (+217%) ‚úÖ
Est. Shares:       5 ‚Üí 18 (+260%) ‚úÖ
Scroll Depth:      55% ‚Üí 78% (+23%) ‚úÖ
```

---

### –≠–¢–ê–ü E: –£–±—Ä–∞—Ç—å —Å—Ç–∞—Ä—ã–π cleanup, –æ—Å—Ç–∞–≤–∏—Ç—å Auto-Restore

**–ß—Ç–æ —É–¥–∞–ª–∏—Ç—å**:
- ‚ùå `src/services/stage-3/cleanup.ts`
- ‚ùå `src/services/stage-3/cleanup-old.ts`
- ‚ùå `src/services/stage-3/cleanup-v2.ts`

**–ß—Ç–æ –æ—Å—Ç–∞–≤–∏—Ç—å**:
- ‚úÖ `.github/workflows/auto-restore-articles.yml` (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)
- ‚úÖ `scripts/restore-articles.js` (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç**:
```
Generation Pipeline (STAGE 0-2):
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ RAW article ready   ‚îÇ  (Phase2: 68-75)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚¨áÔ∏è
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ STAGE 3: VoiceRestoration (NEW!)    ‚îÇ
‚îÇ services/voiceRestorationService.ts ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚¨áÔ∏è
  ‚ú® RAW + RESTORED ready
     (–æ–±–µ –¥–ª—è A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
         ‚¨áÔ∏è
   –≠–∫—Å–ø–æ—Ä—Ç –≤ articles/
         ‚¨áÔ∏è
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ GitHub Workflow (–∫–∞–∂–¥—É—é –Ω–æ—á—å)        ‚îÇ
‚îÇ auto-restore-articles.yml (EXISTING) ‚îÇ
‚îÇ scripts/restore-articles.js          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚¨áÔ∏è
  üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —á–∏—Å—Ç–∫–∞
     (—É–¥–∞–ª—è–µ—Ç –º—É—Å–æ—Ä, –æ—Ñ–æ—Ä–º–ª—è–µ—Ç)
     (–¥–ª—è —É–∂–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π)
```

---

## üìä –ö–ê–ß–ï–°–¢–í–û –ü–û–°–õ–ï –ü–ï–†–ï–î–ï–õ–ö–ò

### –î–æ:
```
–õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: Phase2 Score 65
–°—Ä–µ–¥–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: Phase2 Score 52
–•—É–¥—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: Phase2 Score 38
–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–π —Å—Ç–∞—Ç—å–∏: 10%
```

### –ü–æ—Å–ª–µ:
```
–õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: Phase2 Score 88
–°—Ä–µ–¥–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: Phase2 Score 78
–•—É–¥—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: Phase2 Score 72 (auto-restore –ø–æ–¥–Ω—è–ª)
–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–π —Å—Ç–∞—Ç—å–∏: 95%
```

---

## üéØ –ü–û–î–†–û–ë–ù–û–ï –ó–ê–î–ê–ù–ò–ï –î–õ–Ø –ò–ò

### –ë–ª–æ–∫ 1: –ü—Ä–æ–º–ø—Ç—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã

**–°–æ–∑–¥–∞–π —Ñ–∞–π–ª**: `prompts/stage-0-plan.md`

```markdown
# –ü—Ä–æ–º–ø—Ç –¥–ª—è STAGE 0: PlotBible Generation

## –ö–æ–Ω—Ç–µ–∫—Å—Ç
–¢—ã —Å–æ–∑–¥–∞—ë—à—å "—Å–∫–µ–ª–µ—Ç" —Å—Ç–∞—Ç—å–∏. –≠—Ç–æ JSON —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ä–∞—Å—Å–∫–∞–∑—á–∏—Ü–µ, –µ—ë –∞—Ä—Ö–µ—Ç–∏–ø–µ, —ç–ø–∏–∑–æ–¥–∞—Ö.

## –ü—Ä–∞–≤–∏–ª–∞
1. –†–∞—Å—Å–∫–∞–∑—á–∏—Ü–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–∞ (–≤–æ–∑—Ä–∞—Å—Ç 25-65)
2. –í—ã–±–µ—Ä–∏ –∞—Ä—Ö–µ—Ç–∏–ø –∏–∑: Comeback Queen, Gold Digger Trap, Phoenix, ...
3. 7-12 —ç–ø–∏–∑–æ–¥–æ–≤, –∫–∞–∂–¥—ã–π —Å —è—Å–Ω—ã–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–º
4. –°–µ–Ω—Å–æ—Ä–Ω–∞—è –ø–∞–ª–∏—Ç—Ä–∞: 3-5 –∑–∞–ø–∞—Ö–æ–≤, 3-5 –∑–≤—É–∫–æ–≤, 3-5 —Ç–µ–∫—Å—Ç—É—Ä

## INPUT
–¢–µ–º–∞: [–¢–ï–ú–ê –°–¢–ê–¢–¨–ò]

## OUTPUT
JSON:
```json
{
  "topic": "...",
  "narrator": {
    "age": "NUMBER (25-65)",
    "gender": "female",
    "tone": "exclamatory | sad | ironic | didactic",
    "habits": ["–ø—Ä–∏–≤—ã—á–∫–∞ 1", "–ø—Ä–∏–≤—ã—á–∫–∞ 2", "–ø—Ä–∏–≤—ã—á–∫–∞ 3"]
  },
  "archetype": "Comeback Queen | Gold Digger Trap | Phoenix",
  "sensorPalette": {
    "smells": ["–∑–∞–ø–∞—Ö 1", "–∑–∞–ø–∞—Ö 2", "–∑–∞–ø–∞—Ö 3"],
    "sounds": ["–∑–≤—É–∫ 1", "–∑–≤—É–∫ 2"],
    "textures": ["—Ç–µ–∫—Å—Ç—É—Ä–∞ 1", "—Ç–µ–∫—Å—Ç—É—Ä–∞ 2"]
  },
  "episodes": [
    {
      "hook": "–í–æ–ø—Ä–æ—Å, –∫–æ—Ç–æ—Ä—ã–π —Ü–µ–ø–ª—è–µ—Ç?",
      "conflict": "–ö—Ç–æ –µ—ë –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫?",
      "turning_point": "–ß—Ç–æ –º–µ–Ω—è–µ—Ç—Å—è?"
    }
  ]
}
```
```

**–°–æ–∑–¥–∞–π —Ñ–∞–π–ª**: `prompts/stage-1-episodes.md`

```markdown
# –ü—Ä–æ–º–ø—Ç –¥–ª—è STAGE 1: Episode Writing

## –ö–æ–Ω—Ç–µ–∫—Å—Ç
–¢—ã –ø–∏—à–µ—à—å –û–î–ò–ù —ç–ø–∏–∑–æ–¥ —Å—Ç–∞—Ç—å–∏. –≠—Ç–æ 3000-4000 –∑–Ω–∞–∫–æ–≤ –∂–∏–≤–æ–≥–æ, —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —ç–ø–∏–∑–æ–¥–∞
1. Hook (–∫—Ä—é—á–æ–∫): 200 –∑–Ω–∞–∫–æ–≤
2. External Conflict (–≤–Ω–µ—à–Ω–∏–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç): 800 –∑–Ω–∞–∫–æ–≤
3. Internal Emotion (–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —ç–º–æ—Ü–∏—è): 800 –∑–Ω–∞–∫–æ–≤
4. Turning Point (–ø–æ–≤–æ—Ä–æ—Ç–Ω—ã–π –º–æ–º–µ–Ω—Ç): 600 –∑–Ω–∞–∫–æ–≤
5. Open Loop (–æ—Ç–∫—Ä—ã—Ç–∞—è –ø–µ—Ç–ª—è): 300 –∑–Ω–∞–∫–æ–≤

## –ü—Ä–∞–≤–∏–ª–∞
1. –ò—Å–ø–æ–ª—å–∑—É–π sensorPalette (–∑–∞–ø–∞—Ö–∏, –∑–≤—É–∫–∏, —Ç–µ–∫—Å—Ç—É—Ä—ã)
2. –†–∞–∑–Ω–∞—è –¥–ª–∏–Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π (–∫–æ—Ä–æ—Ç–∫–æ–µ, —Å—Ä–µ–¥–Ω–µ–µ, –¥–ª–∏–Ω–Ω–æ–µ)
3. –ù–µ–∑–∞–∫–æ–Ω—á–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è (–∫–∞–∫ –ª—é–¥–∏ –≥–æ–≤–æ—Ä—è—Ç)
4. –ú–µ–∂–¥–æ–º–µ—Ç–∏—è (–ë–æ–∂–µ, –º–∞–º–∞, —Å–ø–∞—Å–∏—Ç–µ)
5. –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Å PlotBible (–≤–æ–∑—Ä–∞—Å—Ç, –∏–º–µ–Ω–∞, —Ç–æ–Ω)
```

**–°–æ–∑–¥–∞–π —Ñ–∞–π–ª**: `prompts/stage-2-assemble.md`

```markdown
# –ü—Ä–æ–º–ø—Ç –¥–ª—è STAGE 2: Article Assembly

## –ö–æ–Ω—Ç–µ–∫—Å—Ç
–¢—ã —Å–æ–±–∏—Ä–∞–µ—à—å 7-12 —ç–ø–∏–∑–æ–¥–æ–≤ –≤ –û–î–ù–£ –¶–ï–õ–£–Æ —Å—Ç–∞—Ç—å—é.
–ù–ï –∫–æ–ø–∏—Ä—É–µ—à—å —ç–ø–∏–∑–æ–¥—ã. –ü–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ—à—å –∏—Ö, –¥–æ–±–∞–≤–ª—è—è –ø–µ—Ä–µ—Ö–æ–¥—ã –∏ –≥–ª—É–±–∏–Ω—É.

## –ß–∞—Å—Ç–∏ —Å—Ç–∞—Ç—å–∏

### LEDE (–Ω–∞—á–∞–ª–æ): 600-900 –∑–Ω–∞–∫–æ–≤
- –ö—Ä—é—á–æ–∫ —Å —ç–º–æ—Ü–∏–µ–π
- –ù–ï –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ, –∞ –î–ï–ô–°–¢–í–ò–ï/–î–ò–ê–õ–û–ì

### DEVELOPMENT (—Ä–∞–∑–≤–∏—Ç–∏–µ): 1500-2000 –∑–Ω–∞–∫–æ–≤
- –ù–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è

### CLIMAX (–∫—É–ª—å–º–∏–Ω–∞—Ü–∏—è): 1200-1600 –∑–Ω–∞–∫–æ–≤
- –ì–ª–∞–≤–Ω–∞—è —Å—Ü–µ–Ω–∞ –∫–æ–Ω—Ñ—Ä–æ–Ω—Ç–∞—Ü–∏–∏

### RESOLUTION (—Ä–∞–∑–≤—è–∑–∫–∞): 1000-1300 –∑–Ω–∞–∫–æ–≤
- –ï—ë –Ω–æ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è

### FINALE (—Ñ–∏–Ω–∞–ª): 1200-1800 –∑–Ω–∞–∫–æ–≤
- –ü–æ–±–µ–¥–∞ –∏ –≤—ã–∑–æ–≤ —á–∏—Ç–∞—Ç–µ–ª—é
```

**–°–æ–∑–¥–∞–π —Ñ–∞–π–ª**: `prompts/stage-3-restore.md`

```markdown
# –ü—Ä–æ–º–ø—Ç –¥–ª—è STAGE 3: Voice Restoration

## –ö–æ–Ω—Ç–µ–∫—Å—Ç
–¢—ã —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—à—å RAW —Å—Ç–∞—Ç—å—é (—á–∏—Å—Ç—É—é, –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—É—é) –≤ RESTORED —Å—Ç–∞—Ç—å—é (—ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é, –¥—Ä–∞–º–∞—Ç–∏—á–Ω—É—é).

## –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è
–ù–µ –¥–æ–±–∞–≤–ª—è–π —Ñ–∏–∫—Ü–∏—é. –†–∞—Å–∫—Ä—ã–≤–∞–π —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é –∏—Å—Ç–∏–Ω—É, –∫–æ—Ç–æ—Ä–∞—è –±—ã–ª–∞ —Å–∫—Ä—ã—Ç–∞ –≤ RAW –≤–µ—Ä—Å–∏–∏.

## –†–∞–∑–¥–µ–ª–∏ —Å—Ç–∞—Ç—å—é –Ω–∞ —á–∞—Å—Ç–∏:
1. Lede (600-900 –∑–Ω–∞–∫–æ–≤) ‚Üí –°–¥–µ–ª–∞–π –∫—Ä—é—á–æ–∫ –±–æ–ª–µ–µ –ø—Ä–æ–Ω–∑–∏—Ç–µ–ª—å–Ω—ã–º
2. Development ‚Üí –î–æ–±–∞–≤—å —Å–µ–Ω—Å–æ—Ä–Ω—ã–µ –¥–µ—Ç–∞–ª–∏
3. Episodes (–∫–∞–∂–¥—É—é) ‚Üí –ò–Ω—ä–µ–∫—Ç–∏—Ä—É–π –≥–æ–ª–æ—Å —Ä–∞—Å—Å–∫–∞–∑—á–∏–∫–∞
4. Climax ‚Üí –ü–æ–∫–∞–∂–∏ —Ä–µ–∞–∫—Ü–∏—é –∞–Ω—Ç–∞–≥–æ–Ω–∏—Å—Ç–∞ –≤ –¥–µ—Ç–∞–ª—è—Ö
5. Resolution ‚Üí –°–¥–µ–ª–∞–π –ø–æ–±–µ–¥—É –Ω–µ—Å–æ–º–Ω–µ–Ω–Ω–æ–π
6. Finale ‚Üí –î–æ–±–∞–≤—å –º–æ—â–Ω–æ—Å—Ç—å –∏ –≤—ã–∑–æ–≤ —á–∏—Ç–∞—Ç–µ–ª—é

## –ü—Ä–∞–≤–∏–ª–∞
1. –°–û–•–†–ê–ù–ò –í–°–ï –§–ê–ö–¢–´ (–∏–º–µ–Ω–∞, –¥–∞—Ç—ã, —Å–æ–±—ã—Ç–∏—è)
2. –î–û–ë–ê–í–¨ –≠–ú–û–¶–ò–Æ (—Å–µ–Ω—Å–æ—Ä–Ω—ã–µ –¥–µ—Ç–∞–ª–∏, –¥–∏–∞–ª–æ–≥–∏, –º–æ–Ω–æ–ª–æ–≥)
3. –í–ê–†–ò–ò–†–£–ô –ü–†–ï–î–õ–û–ñ–ï–ù–ò–Ø (Short. Medium. Longer.)
4. –ò–ù–™–ï–ö–¢–ò–†–£–ô –ì–û–õ–û–° (–ø—Ä–∏–≤—ã—á–∫–∏, –∏–Ω—Ç–æ–Ω–∞—Ü–∏—è, —Ä–µ—á–µ–≤—ã–µ –º–∞—Ä–∫–µ—Ä—ã)
5. –ù–ï –î–û–ë–ê–í–õ–Ø–ô –§–ò–ö–¶–ò–Æ (—Ç–æ–ª—å–∫–æ —Ä–∞—Å–∫—Ä—ã–≤–∞–π —á—Ç–æ –±—ã–ª–æ —Å–∫—Ä—ã—Ç–æ)
```

**–°–æ–∑–¥–∞–π —Ñ–∞–π–ª**: `prompts/shared/voice-guidelines.md`

```markdown
# –ü—Ä–∞–≤–∏–ª–∞ –ñ–∏–≤–æ–≥–æ –ì–æ–ª–æ—Å–∞

## –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Ç–µ–∫—Å—Ç –ñ–ò–í–´–ú

1. **–†–∞–∑–Ω–∞—è –¥–ª–∏–Ω–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π**
   ‚úÖ "–ö–æ—Ä–æ—Ç–∫–æ–µ. –°—Ä–µ–¥–Ω–µ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –º—ã—Å–ª—å. –î–ª–∏–Ω–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª—è–µ—Ç –¥–µ—Ç–∞–ª–∏ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç. –°–Ω–æ–≤–∞ –∫–æ—Ä–æ—Ç–∫–æ–µ."
   ‚ùå "–Ø –±—ã–ª–∞ –≥—Ä—É—Å—Ç–Ω–∞—è. –Ø —á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∞ –±–æ–ª—å. –Ø –¥—É–º–∞–ª–∞ –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö. –Ø –ø—Ä–∏–Ω—è–ª–∞ —Ä–µ—à–µ–Ω–∏–µ."

2. **–ù–µ–∑–∞–∫–æ–Ω—á–µ–Ω–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è**
   ‚úÖ "–†—É–∫–∏ —Ç—Ä—è—Å–ª–∏—Å—å. –ú–æ–ª—á–∞–ª–∞. –ù–µ –º–æ–≥–ª–∞ –≥–æ–≤–æ—Ä–∏—Ç—å."
   ‚ùå "–ú–æ–∏ —Ä—É–∫–∏ —Ç—Ä—è—Å–ª–∏—Å—å. –Ø –º–æ–ª—á–∞–ª–∞. –Ø –Ω–µ –º–æ–≥–ª–∞ –≥–æ–≤–æ—Ä–∏—Ç—å."

3. **–ú–µ–∂–¥–æ–º–µ—Ç–∏—è –∏ –≤–æ—Å–∫–ª–∏—Ü–∞–Ω–∏—è**
   ‚úÖ "–ë–æ–∂–µ, –∫–∞–∫ —è –±—ã–ª–∞ —Å–ª–µ–ø–∞! –ú–∞–º–∞, —Å–ø–∞—Å–∏—Ç–µ!"
   ‚ùå "–Ø –æ—Å–æ–∑–Ω–∞–ª–∞ —Å–≤–æ—é –æ—à–∏–±–∫—É. –ü–æ–ø—Ä–æ—Å–∏–ª–∞ –ø–æ–º–æ—â—å."

4. **–°–µ–Ω—Å–æ—Ä–Ω—ã–µ –¥–µ—Ç–∞–ª–∏**
   ‚úÖ "–ó–∞–ø–∞—Ö –∫–æ—Ñ–µ. –•–æ–ª–æ–¥ –≤ —Å–ø–∏–Ω–µ. –¢–∏—à–∏–Ω–∞. –¢–æ–ª—å–∫–æ –µ—ë –≥–æ–ª–æ—Å."
   ‚ùå "–Ø –±—ã–ª–∞ –≤ –∫–æ–º–Ω–∞—Ç–µ, –ø–∏–ª–∞ –∫–æ—Ñ–µ –∏ —á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∞ —Å–µ–±—è –ø–ª–æ—Ö–æ."

5. **–†–µ–∞–ª—å–Ω—ã–µ —Ä–µ—á–µ–≤—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏**
   ‚úÖ "–ò –≤–æ—Ç —è –ø–æ–Ω–∏–º–∞—é. –í–æ—Ç —Ç–æ–≥–¥–∞. –≠—Ç–æ –±—ã–ª–æ –≤ –º–∞–µ..."
   ‚ùå "–ó–∞—Ç–µ–º —è –æ—Å–æ–∑–Ω–∞–ª–∞. –≠—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ –≤ –º–µ—Å—è—Ü–µ –º–∞–π."
```

---

### –ë–ª–æ–∫ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ —ç–ø–∏–∑–æ–¥–æ–≤

**–°–æ–∑–¥–∞–π —Ñ–∞–π–ª**: `src/utils/levenshtein-distance.ts`

```typescript
// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —è–≤–ª—è—é—Ç—Å—è –ª–∏ —ç–ø–∏–∑–æ–¥—ã –¥—É–±–ª—è–º–∏

export function levenshteinDistance(str1: string, str2: string): number {
  const len1 = str1.length
  const len2 = str2.length
  const matrix: number[][] = []

  for (let i = 0; i <= len2; i++) {
    matrix[i] = [i]
  }
  for (let j = 0; j <= len1; j++) {
    matrix[0][j] = j
  }

  for (let i = 1; i <= len2; i++) {
    for (let j = 1; j <= len1; j++) {
      if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
        matrix[i][j] = matrix[i - 1][j - 1]
      } else {
        matrix[i][j] = Math.min(
          matrix[i - 1][j - 1] + 1,
          matrix[i][j - 1] + 1,
          matrix[i - 1][j] + 1
        )
      }
    }
  }

  return matrix[len2][len1]
}

export function calculateSimilarity(str1: string, str2: string): number {
  const distance = levenshteinDistance(str1, str2)
  const maxLength = Math.max(str1.length, str2.length)
  return 1 - distance / maxLength
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
// const similarity = calculateSimilarity(episode1.text, episode2.text)
// if (similarity > 0.75) console.log('–î–£–ë–õ–¨!')
```

---

### –ë–ª–æ–∫ 3: Quality Gate –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞

**–°–æ–∑–¥–∞–π —Ñ–∞–π–ª**: `src/utils/quality-gate.ts`

```typescript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ

import { checkPhase2Score } from './phase2-checker'

export async function qualityGate(
  content: string,
  minPhase2Score: number = 70,
  minLength: number = 5000,
  context?: string
): Promise<{
  isValid: boolean
  phase2Score: number
  length: number
  issues: string[]
}> {
  const issues: string[] = []
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –î–ª–∏–Ω–∞
  if (content.length < minLength) {
    issues.push(`–°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∞—è: ${content.length}/${minLength} –∑–Ω–∞–∫–æ–≤`)
  }
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: Phase 2 Score
  const phase2Score = await checkPhase2Score(content)
  if (phase2Score < minPhase2Score) {
    issues.push(`Phase2 Score –Ω–∏–∑–∫–∏–π: ${phase2Score}/${minPhase2Score}`)
  }
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –ù–µ—Ç –∑–∞–ø—Ä–µ—â—ë–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
  const forbidden = ['–∫–∞–∫ —è–∑—ã–∫ –º–æ–¥–µ–ª–∏', '–∫–∞–∫ AI', 'I apologize']
  for (const word of forbidden) {
    if (content.toLowerCase().includes(word.toLowerCase())) {
      issues.push(`–ù–∞–π–¥–µ–Ω AI-–º–∞—Ä–∫–µ—Ä: "${word}"`)
    }
  }
  
  return {
    isValid: issues.length === 0,
    phase2Score,
    length: content.length,
    issues
  }
}
```

---

### –ë–ª–æ–∫ 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ STAGE 1

**–ò–∑–º–µ–Ω–∏—Ç—å —Ñ–∞–π–ª**: `src/services/stage-1/generate-episodes.ts`

```typescript
import { qualityGate } from '../../utils/quality-gate'
import { restoreVoice } from '../restore/restore-voice'
import { calculateSimilarity } from '../../utils/levenshtein-distance'

export async function generateEpisodes(plotBible: any): Promise<any[]> {
  const episodes: any[] = []
  
  for (let i = 0; i < plotBible.episodes.length; i++) {
    let episode = await generateOneEpisode(plotBible.episodes[i])
    let attempts = 0
    
    // –ü–†–û–í–ï–†–ö–ê 1: –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å
    while (attempts < 3) {
      const isDuplicate = episodes.some(e => 
        calculateSimilarity(e.text, episode.text) > 0.75
      )
      
      if (isDuplicate) {
        console.log(`‚ö†Ô∏è –≠–ø–∏–∑–æ–¥ ${i} - –¥—É–±–ª—å, —Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º...`)
        episode = await generateOneEpisode(plotBible.episodes[i])
        attempts++
      } else {
        break
      }
    }
    
    // –ü–†–û–í–ï–†–ö–ê 2: –ö–∞—á–µ—Å—Ç–≤–æ
    let validation = await qualityGate(episode.text, 70, 3000)
    
    if (!validation.isValid) {
      console.log(`‚ö†Ô∏è –≠–ø–∏–∑–æ–¥ ${i} - –∫–∞—á–µ—Å—Ç–≤–æ –Ω–∏–∑–∫–æ–µ:`, validation.issues)
      
      // Auto-restore:
      while (!validation.isValid && attempts < 3) {
        episode.text = await restoreVoice(episode.text, plotBible)
        validation = await qualityGate(episode.text, 70, 3000)
        attempts++
      }
    }
    
    episodes.push(episode)
  }
  
  return episodes
}
```

---

## üé¨ –î–ï–¢–ê–õ–¨–ù–û–ï –í–´–ü–û–õ–ù–ï–ù–ò–ï

### –°—Ä–æ–∫–∏ –ø–æ –±–ª–æ–∫–∞–º:

| –ë–ª–æ–∫ | –û–ø–∏—Å–∞–Ω–∏–µ | –í—Ä–µ–º—è | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|------|----------|-------|----------|
| **A** | –í—ã–Ω–µ—Å—Ç–∏ –ø—Ä–æ–º–ø—Ç—ã –≤ /prompts | 4—á | üî¥ –ü–ï–†–í–´–ô |
| **B** | –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ STAGE 0 | 2—á | üî¥ –ü–ï–†–í–´–ô |
| **C** | –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ STAGE 1 | 3—á | üî¥ –ü–ï–†–í–´–ô |
| **D** | Voice Restoration STAGE 3 | ‚úÖ –ì–û–¢–û–í–û | üî¥ –ì–û–¢–û–í–û |
| **E** | –£–±—Ä–∞—Ç—å cleanup, –æ—Å—Ç–∞–≤–∏—Ç—å auto-restore | 2—á | üü† –í–¢–û–†–û–ô |

**–í—Å–µ–≥–æ**: 11 —á–∞—Å–æ–≤ —Ä–∞–±–æ—Ç—ã (–ë–ª–æ–∫ D —É–∂–µ –≥–æ—Ç–æ–≤!)

---

## üìã –ü–†–û–í–ï–†–ö–ê –í–´–ü–û–õ–ù–ï–ù–ò–Ø

### –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è ALL –±–ª–æ–∫–æ–≤:

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ –ø—Ä–æ–º–ø—Ç—ã –≤ /prompts
ls -la prompts/

# 2. –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ç–∞—Ç—å—é
npm run both --count=1 --topic="Test topic"

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Phase2 Score
cat articles/*/latest.md | grep phase2_score

# 4. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ Score >= 75
npm run validate

# 5. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å 5 —Å—Ç–∞—Ç–µ–π, –≤—Å–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å >= 70
npm run factory --count=5
```

### –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:

```
‚úÖ –í—Å–µ –ø—Ä–æ–º–ø—Ç—ã –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ /prompts
‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ –Ω–µ –ø–∞–¥–∞–µ—Ç (graceful fallback —Ä–∞–±–æ—Ç–∞–µ—Ç)
‚úÖ –î—É–±–ª–∏ —ç–ø–∏–∑–æ–¥–æ–≤ —É–¥–∞–ª—è—é—Ç—Å—è (Levenshtein > 0.75)
‚úÖ Quality gate —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ
‚úÖ Phase2 Score 75+ –Ω–∞ –≤—Å–µ—Ö —Å—Ç–∞—Ç—å—è—Ö
‚úÖ Voice Restoration —Ä–∞–±–æ—Ç–∞–µ—Ç (RAW + RESTORED –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è)
‚úÖ Auto-restore –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å—Ç–∞—Ç—å–∏ –Ω–æ—á—å—é
‚úÖ cleanup.ts —É–¥–∞–ª—ë–Ω
```

---

## ‚ö° –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –î–õ–Ø –£–°–ü–ï–•–ê

1. **–ù–µ –ø—É—Ç–∞–π STAGE 3 Voice Restoration —Å Auto-Restore Workflow**
   - STAGE 3 = –≥–µ–Ω–µ—Ä–∞—Ü–∏—è (RAW ‚Üí RESTORED)
   - Auto-Restore = —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —á–∏—Å—Ç–∫–∞ —É–∂–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö
   - –û–±–µ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ, —Ä–∞–∑–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã!

2. **–ù–µ –∏–≥–Ω–æ—Ä–∏—Ä—É–π Quality Gate** - –µ—Å–ª–∏ Phase2 < 70, –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π, –Ω–µ –ø—É–±–ª–∏–∫—É–π
3. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–π PlotBible** - –≤—Å–µ —á–∞—Å—Ç–∏ –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ—Ç –∂–µ PlotBible
4. **–ü–µ—Ä–µ–ø–∏—Å—ã–≤–∞–π –≤ STAGE 2** - –Ω–µ –∫–æ–ø–∏—Ä—É–π –∏–∑ —ç–ø–∏–∑–æ–¥–æ–≤
5. **Auto-Restore –∫–∞–∂–¥—É—é –Ω–æ—á—å** - —ç—Ç–æ —Ç–≤–æ—è —Å–ø–∞—Å–∞—Ü–∏—è –¥–ª—è –Ω–∏–∑–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π
6. **–ü—Ä–æ–º–ø—Ç—ã –∏–∑ —Ñ–∞–π–ª–æ–≤** - –æ–¥–Ω–∞ –≤–µ—Ä—Å–∏—è –∏—Å—Ç–∏–Ω—ã, –≤—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –µ—ë –∏—Å–ø–æ–ª—å–∑—É—é—Ç

---

**–í—ã–ø–æ–ª–Ω–∏ –í–°–ï –±–ª–æ–∫–∏ –ê-–ï –ø–æ –ø–æ—Ä—è–¥–∫—É. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Å–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —á–∞—Å—ã.** ‚è∞